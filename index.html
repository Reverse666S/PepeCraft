<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>PepeCraft ‚Äì Clan Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0f1220; --panel:#171a2b; --muted:#232742; --fg:#e6e8ff;
      --accent:#7c5cff; --good:#25c28a; --bad:#ff5c7c; --warn:#f5a524;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
         background:linear-gradient(180deg,#0b0e1a, #0f1220); color:var(--fg)}
    a{color:var(--accent);text-decoration:none}
    img{max-width:100%}
    .wrap{max-width:1100px;margin:0 auto;padding:20px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:14px 0}
    .brand{display:flex;gap:12px;align-items:center}
    .brand img{width:56px;height:56px;border-radius:14px;border:2px solid #0003}
    .brand h1{font-size:22px;margin:0;letter-spacing:.6px}
    .nav{display:flex;gap:8px;flex-wrap:wrap}
    .btn{background:var(--muted);color:var(--fg);border:1px solid #0005;border-radius:10px;
         padding:10px 14px;cursor:pointer;transition:.15s;font-weight:600}
    .btn:hover{transform:translateY(-1px);background:#2a2f57}
    .btn.primary{background:var(--accent);border-color:#0000}
    .btn.good{background:var(--good)}
    .btn.bad{background:var(--bad)}
    .btn.warn{background:var(--warn);color:#111}
    .btn.small{padding:6px 10px;font-size:14px}
    .grid{display:grid;gap:16px}
    @media(min-width:900px){ .grid.cols-2{grid-template-columns:1fr 1fr} .grid.cols-3{grid-template-columns:repeat(3,1fr)} }
    .card{background:var(--panel);border:1px solid #0006;border-radius:16px;padding:16px}
    .card h3{margin:0 0 10px 0}
    .muted{color:#aab}
    .input, textarea, select{width:100%;padding:10px;border-radius:10px;border:1px solid #0006;background:#11152b;color:var(--fg)}
    textarea{min-height:120px;resize:vertical}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .pill{padding:6px 10px;border-radius:999px;background:#232742;border:1px solid #0006;font-size:12px}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{padding:10px;border-bottom:1px solid #2a2e4d;text-align:left}
    .table th{color:#9db}
    .center{display:flex;align-items:center;justify-content:center}
    .right{margin-left:auto}
    .tag{font-size:12px;padding:3px 8px;border-radius:8px;background:#2b315d;border:1px solid #0006}
    .status{display:inline-flex;align-items:center;gap:8px;padding:10px;border-radius:12px;border:1px dashed #445}
    .kpi{background:linear-gradient(180deg,#1b1f39,#151932);padding:14px;border-radius:16px;border:1px solid #0006}
    .avatar{width:42px;height:42px;border-radius:50%;object-fit:cover;border:2px solid #0005;background:#0003}
    .flex{display:flex;gap:12px;align-items:center}
    .hidden{display:none !important}
    footer{opacity:.7;padding:30px 0}
    .badge{background:#2c315d;border:1px solid #0007;border-radius:999px;padding:4px 10px;font-size:12px}
    .support-type{display:grid;grid-template-columns:repeat(4,minmax(140px,1fr));gap:12px}
    .support-type button{height:70px}
    .toast{position:fixed;bottom:16px;right:16px;background:#1d2244;border:1px solid #0006;padding:12px 14px;border-radius:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <img src="pepecraft.png" alt="PepeCraft Logo" />
        <div>
          <h1>PEPECRAFT ‚Äì Clan Portal</h1>
          <div class="muted" id="who"></div>
        </div>
      </div>
      <nav class="nav" id="topNav"></nav>
    </header>

    <!-- ROUTES -->
    <main id="route"></main>

    <footer class="center">
      <div class="muted">¬© <span id="yr"></span> PepeCraft ¬∑ Teamseite</div>
    </footer>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast hidden"></div>

<script>
/* =========================
   Tiny SPA with Render API
   Roles: owner, admin, member
   ========================= */
const API = "https://datenbank-z6bb.onrender.com/api";

const qs = s => document.querySelector(s);
const el = (t,cls) => Object.assign(document.createElement(t), { className: cls||"" });

// Seed default owner & initial users (nur, falls DB leer)
(async function seed(){
  let users = await (await fetch(`${API}/users`)).json();

  if(!users.find(u=>u.role==="owner")){
    users.push({id:crypto.randomUUID(), username:"RandomAuto", pass:"RandomAuto", role:"owner", avatar:"", created:Date.now()});
  }

  const existingUsernames = users.map(u=>u.username);
  const newUsers = [
    {username:"Mausbaery", pass:"mausbaery", role:"admin"},
    {username:"Dragon", pass:"dragon", role:"admin"},
    {username:"Tornado", pass:"pikachu", role:"admin"},
    {username:"Tobi", pass:"huehnertopf", role:"admin"},
    {username:"Danger222", pass:"danger", role:"admin"},
    {username:"mb1095", pass:"markus", role:"admin"},
    {username:"Pegasus84", pass:"verena", role:"admin"},
    {username:"iti_hd", pass:"terry", role:"member"},
    {username:"ByRelaxo", pass:"relaxo", role:"member"},
    {username:"Devil", pass:"devildoom", role:"member"},
    {username:"CraftExplain", pass:"craft", role:"member"},
    {username:"SteinPool", pass:"reicherdude", role:"member"},
    {username:"Jannik", pass:"greentea", role:"member"},
  ];

  newUsers.forEach(u=>{
    if(!existingUsernames.includes(u.username)){
      users.push({...u, id:crypto.randomUUID(), avatar:"", created:Date.now()});
    }
  });

  await fetch(`${API}/users`, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(users)
  });

  // Home-Seite
  await fetch(`${API}/home`, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      title:"Willkommen bei PepeCraft",
      content:"Dies ist die Teamseite des PepeCraft Teams. Zugriff kann √ºber RandomAuto angefordert werden (Seite noch in Arbeiten)",
      hero:"pepecraft.png"
    })
  });

  // Jahr im Footer
  document.getElementById("yr").textContent = new Date().getFullYear();
})();


// =========================
// Session & Auth
// =========================
function session() {
  return JSON.parse(localStorage.getItem(DB.session) || "null");
}

function loginAs(u) {
  localStorage.setItem(DB.session, JSON.stringify(u));
  renderTop();
  routeTo("home");
  toast("Angemeldet als " + u.username);
}

function logout() {
  localStorage.removeItem(DB.session);
  renderTop();
  routeTo("login");
}

// =========================
// Backend-Funktionen (Render API)
// =========================
async function getUsers() {
  const res = await fetch("https://datenbank-z6bb.onrender.com/api/users");
  return await res.json();
}

async function setUsers(arr) {
  await fetch("https://datenbank-z6bb.onrender.com/api/users", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(arr)
  });
}

async function getHome() {
  const res = await fetch("https://datenbank-z6bb.onrender.com/api/home");
  return await res.json();
}

async function saveHome(v) {
  await fetch("https://datenbank-z6bb.onrender.com/api/home", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(v)
  });
}

async function getLinks() {
  const res = await fetch("https://datenbank-z6bb.onrender.com/api/links");
  return await res.json();
}

async function setLinks(x) {
  await fetch("https://datenbank-z6bb.onrender.com/api/links", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(x)
  });
}

async function getMembers() {
  const res = await fetch("https://datenbank-z6bb.onrender.com/api/members");
  return await res.json();
}

async function setMembers(x) {
  await fetch("https://datenbank-z6bb.onrender.com/api/members", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(x)
  });
}

async function getSupports() {
  const res = await fetch("https://datenbank-z6bb.onrender.com/api/supports");
  return await res.json();
}

async function setSupports(x) {
  await fetch("https://datenbank-z6bb.onrender.com/api/supports", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(x)
  });
}

// =========================
// Berechtigungen
// =========================
function can(view) {
  const me = session();
  if (!me) return false;
  if (me.role === "owner") return true;
  const map = {
    admin: ["admin", "owner"],
    member: ["member", "admin", "owner"]
  };
  if (view === "owner") return me.role === "owner";
  if (view === "admin") return map.admin.includes(me.role);
  return map.member.includes(me.role);
}

// =========================
// Navbar rendern
// =========================
function renderTop() {
  const me = session();
  qs("#who").textContent = me ? `Eingeloggt: ${me.username} (${me.role})` : "Nicht eingeloggt";
  const nav = qs("#topNav");
  nav.innerHTML = "";

  const add = (label, view, guard) => {
    if (guard === false) return;
    const b = el("button", "btn small");
    b.textContent = label;
    b.onclick = () => routeTo(view);
    nav.appendChild(b);
  };

  add("Start", "home", true);
  add("Mitglieder", "members", true);
  add("Team", "team", true);
  add("Links", "links", true);
  add("Support", "support", true);
  add("Konten", "accounts", can("admin"));
  add("Adminpanel", "admin", can("admin"));

  if (me) {
    const prof = el("button", "btn small");
    prof.textContent = "Profil";
    prof.onclick = () => routeTo("profile");
    nav.appendChild(prof);

    const out = el("button", "btn small bad");
    out.textContent = "Logout";
    out.onclick = logout;
    nav.appendChild(out);
  } else {
    const inn = el("button", "btn small primary");
    inn.textContent = "Login";
    inn.onclick = () => routeTo("login");
    nav.appendChild(inn);
  }
}

/* =========================
   Async Views for Render API
========================= */

async function viewLogin(){
  const c = el("div","grid cols-2");
  const left = el("div","card");
  left.innerHTML = `
    <h3>Login</h3>
    <div class="muted">Der Seiteninhaber legt Accounts an. Standard-Owner: <code>RandomAuto</code></div>
    <div class="row" style="margin-top:10px">
      <input class="input" id="u" placeholder="Username" />
      <input class="input" id="p" placeholder="Passwort" type="password" />
      <button class="btn primary" id="go">Einloggen</button>
    </div>`;
  left.querySelector("#go").onclick = async ()=>{
    const u = left.querySelector("#u").value.trim();
    const p = left.querySelector("#p").value;
    const users = await getUsers();
    const hit = users.find(x=>x.username===u && x.pass===p);
    if(!hit) return toast("Falsche Zugangsdaten", true);
    loginAs(hit);
  };
  const right = el("div","card center");
  right.innerHTML = `<img src="pepecraft.png" alt="PepeCraft" style="max-height:220px;border-radius:16px;border:1px solid #0006">`;
  c.append(left,right);
  return c;
}

async function viewHome(){
  const home = await getHome();
  const wrap = el("div","grid cols-2");

  const hero = el("div","card");
  hero.innerHTML = `
    <img src="${home.hero||'pepecraft.png'}" alt="Hero" style="width:100%;border-radius:14px;border:1px solid #0006">
    <h2 style="margin:12px 0 6px 0">${home.title||'PepeCraft'}</h2>
    <p class="muted">${home.content||''}</p>
    <div class="row">
      <span class="badge">Clan Portal</span>
      <span class="badge">Minecraft</span>
      <span class="badge">Support</span>
    </div>`;
  wrap.appendChild(hero);

  const stats = el("div","grid");
  stats.appendChild(cardKPI("Mitglieder",(await getMembers()).length));
  stats.appendChild(cardKPI("Accounts",(await getUsers()).length));
  stats.appendChild(cardKPI("Support-Tickets",(await getSupports()).length));
  wrap.appendChild(stats);

  if(can("admin")){
    const edit = el("div","card");
    edit.innerHTML = `
      <h3>Startseite bearbeiten</h3>
      <div class="row"><input id="t" class="input" value="${home.title||''}" placeholder="Titel"></div>
      <div class="row"><input id="h" class="input" value="${home.hero||'pepecraft.png'}" placeholder="Hero-Bildpfad"></div>
      <div class="row"><textarea id="c" class="input" placeholder="Inhalt">${home.content||''}</textarea></div>
      <button class="btn primary" id="save">Speichern</button>`;
    edit.querySelector("#save").onclick = async ()=>{
      await saveHome({ title: edit.querySelector("#t").value, hero: edit.querySelector("#h").value, content: edit.querySelector("#c").value });
      toast("Startseite aktualisiert");
      await routeTo("home");
    };
    wrap.appendChild(edit);
  }

  return wrap;
}

async function viewMembers(){
  const wrap = el("div","grid");
  wrap.appendChild(cardMembersTable(true)); // editable = true
  return wrap;
}

async function viewTeam(){
  const staff = (await getUsers()).filter(u=>u.role!=="member");
  const card = el("div","card");
  card.innerHTML = `<h3>Teammitglieder</h3>`;
  const tbl = table(["Avatar","Username","Rolle","Seit"], staff.map(u=>[
    `<img class="avatar" src="${u.avatar||'pepecraft.png'}" alt="">`,
    u.username,
    `<span class="tag">${u.role}</span>`,
    new Date(u.created).toLocaleDateString()
  ]));
  card.appendChild(tbl);
  return card;
}

async function viewLinks(){
  const wrap = el("div","grid cols-2");
  const list = el("div","card");
  const data = await getLinks();
  list.innerHTML = `<h3>Links</h3>`;
  const tbl = table(["Name","URL","Aktion"], data.map((l,i)=>[
    `<span class="tag">${l.name}</span>`,
    `<a href="${l.url}" target="_blank">${l.url}</a>`,
    can("admin") ? `<button class="btn small bad" onclick="delLink(${i})">L√∂schen</button>` : ""
  ]));
  list.appendChild(tbl);
  wrap.appendChild(list);

  if(can("admin")){
    const form = el("div","card");
    form.innerHTML = `
      <h3>Link hinzuf√ºgen</h3>
      <div class="row">
        <input class="input" id="ln" placeholder="Name">
        <input class="input" id="lu" placeholder="https://...">
        <button class="btn primary" id="ls">Speichern</button>
      </div>`;
    form.querySelector("#ls").onclick = async ()=>{
      const n=form.querySelector("#ln").value.trim(), u=form.querySelector("#lu").value.trim();
      if(!n||!u) return toast("Name & URL angeben",true);
      const x = await getLinks(); x.push({name:n,url:u}); await setLinks(x); toast("Link gespeichert"); await routeTo("links");
    };
    wrap.appendChild(form);
  }

  return wrap;
}

async function viewSupport(){
  const wrap = el("div","grid");
  const supports = await getSupports();
  const me = session();

  const head = el("div","grid cols-3");
  head.append(kpiBox("Deine Eintr√§ge diese Woche", supports.filter(s=>s.by===me?.username).length));
  head.append(kpiBox("Gesamt Supports", supports.length));
  head.append(kpiBox("Teamranking (Top)", topRanking()));
  wrap.appendChild(head);

  const form = el("div","card");
  form.innerHTML = `
    <h3>üéß Neuen Support eintragen</h3>
    <div class="row">
      <div style="flex:1"><label class="muted">Dein Name</label><input class="input" id="s_by" value="${me?.username||''}"></div>
      <div style="flex:1"><label class="muted">User ID eintragen</label><input class="input" id="s_who" placeholder="Discord ID + Grund"></div>
    </div>
    <div class="support-type" style="margin:12px 0">
      <button class="btn good"   onclick="markStatus('gel√∂st')">‚úî Gel√∂st</button>
      <button class="btn bad"    onclick="markStatus('nicht_gel√∂st')">‚úñ Nicht Gel√∂st</button>
      <button class="btn"        onclick="markStatus('kl√§rung')">‚ùì Weitere Kl√§rung</button>
      <button class="btn warn"   onclick="markStatus('weitergeleitet')">‚û° Weitergeleitet</button>
    </div>
    <textarea class="input" id="s_desc" placeholder="Kurzbeschreibung"></textarea>
    <div class="row" style="margin-top:10px"><button class="btn primary" id="s_save">üìù Support eintragen</button></div>`;
  let currentStatus="kl√§rung";
  window.markStatus = s=>{currentStatus=s; toast("Status: "+s);};
  form.querySelector("#s_save").onclick = async ()=>{
    const by=form.querySelector("#s_by").value.trim();
    const who=form.querySelector("#s_who").value.trim();
    const desc=form.querySelector("#s_desc").value.trim();
    if(!by||!who) return toast("Dein Name und Spielername erforderlich",true);
    supports.push({id:crypto.randomUUID(),by,who,desc,status:currentStatus,at:Date.now()});
    await setSupports(supports);
    toast("Support gespeichert");
    await routeTo("support");
  };
  wrap.appendChild(form);

  const list = el("div","card");
  list.innerHTML=`<h3>Support-Eintr√§ge</h3>`;
  const tbl = table(["Zeit","Von","Spieler","Status","Beschreibung","Aktion"],
    supports.slice().reverse().map((s,i)=>[
      new Date(s.at).toLocaleString(),
      s.by,
      s.who,
      `<span class="tag">${s.status}</span>`,
      s.desc||"",
      can("admin")?`<button class="btn small bad" onclick="delSupport('${s.id}')">L√∂schen</button>`:""
    ]));
  list.appendChild(tbl);
  wrap.appendChild(list);

  return wrap;
}

async function viewAccounts(){ 
  if(!can("admin")) return denyCard();
  const c = el("div","grid");
  c.appendChild(cardUsersTable());
  return c;
}

async function viewAdmin(){
  if(!can("admin")) return denyCard();
  const c = el("div","grid cols-2");
  c.appendChild(cardCreateUser());
  c.appendChild(cardUsersTable());
  c.appendChild(cardMembersTable(true));
  c.appendChild(cardMemberForm());
  return c;
}

async function viewProfile(){
  const me = session(); if(!me) return denyCard("Bitte zuerst einloggen.");
  const card = el("div","card");
  card.innerHTML = `
    <h3>Profil</h3>
    <div class="flex">
      <img class="avatar" id="pfp" src="${me.avatar||'pepecraft.png'}" alt="">
      <div class="row">
        <input class="input" id="av" type="file" accept="image/*">
      </div>
      <button class="btn primary right" id="savep">Speichern</button>
    </div>`;
  card.querySelector("#savep").onclick = async ()=>{
    const users = await getUsers();
    const idx = users.findIndex(u=>u.id===me.id);
    const file = card.querySelector("#av").files[0];
    if(file){
      const b64 = await fileToDataUrl(file);
      users[idx].avatar=b64;
    }
    await setUsers(users);
    loginAs(users[idx]);
    toast("Profil aktualisiert");
  };
  return card;
}

/* Components */
function cardKPI(label,val){
  const c = el("div","kpi");
  c.innerHTML = `<div class="muted">${label}</div><div style="font-size:28px;font-weight:800">${val}</div>`;
  return c;
}

function kpiBox(label,val){
  const c = el("div","card");
  c.innerHTML = `<div class="muted">${label}</div><div style="font-size:24px;font-weight:800;margin-top:6px">${val}</div>`;
  return c;
}

function table(headers, rows){
  const t = el("table","table");
  const thead = el("thead"), tr = el("tr");
  headers.forEach(h=>{ const th=el("th"); th.innerHTML=h; tr.appendChild(th); });
  thead.appendChild(tr); t.appendChild(thead);
  const tb = el("tbody");
  rows.forEach(r=>{
    const tr = el("tr");
    r.forEach(c=>{ const td=el("td"); td.innerHTML = c; tr.appendChild(td); });
    tb.appendChild(tr);
  });
  t.appendChild(tb);
  return t;
}

function denyCard(txt){
  const c = el("div","card");
  c.innerHTML = `<div class="status">üîí ${txt||"Keine Berechtigung"}</div>`;
  return c;
}

/* Users */
async function cardCreateUser(){
  const c = el("div","card");
  c.innerHTML = `
    <h3>Account erstellen</h3>
    <div class="row">
      <input class="input" id="cu_u" placeholder="Username">
      <input class="input" id="cu_p" placeholder="Passwort">
      <select class="input" id="cu_r">
        <option value="member">member</option>
        <option value="admin">admin</option>
        <option value="owner">owner</option>
      </select>
      <button class="btn primary" id="cu_s">Anlegen</button>
    </div>`;
  c.querySelector("#cu_s").onclick = async ()=>{
    const u=c.querySelector("#cu_u").value.trim();
    const p=c.querySelector("#cu_p").value.trim();
    const r=c.querySelector("#cu_r").value;
    if(!u||!p) return toast("Username & Passwort angeben", true);
    const users = await getUsers();
    if(users.find(x=>x.username===u)) return toast("Username existiert bereits", true);
    users.push({id:crypto.randomUUID(),username:u,pass:p,role:r,avatar:"",created:Date.now()});
    await setUsers(users); toast("Account erstellt");
    await routeTo("admin");
  };
  return c;
}

async function cardUsersTable(){
  const users = await getUsers();
  const c = el("div","card");
  c.innerHTML = `<h3>Alle Konten</h3>`;
  const rows = users.map(u=>[
    `<div class="flex"><img class="avatar" src="${u.avatar||'pepecraft.png'}"><b>${u.username}</b></div>`,
    `<span class="tag">${u.role}</span>`,
    new Date(u.created).toLocaleDateString(),
    session()?.id===u.id? "‚Äî" : `
      <div class="row">
        <button class="btn small" onclick="setRole('${u.id}','member')">member</button>
        <button class="btn small" onclick="setRole('${u.id}','admin')">admin</button>
        ${can('owner')?`<button class="btn small warn" onclick="setRole('${u.id}','owner')">owner</button>`:""}
        <button class="btn small bad" onclick="delUser('${u.id}')">l√∂schen</button>
      </div>`
  ]);
  c.appendChild(table(["Konto","Rolle","Seit","Aktionen"], rows));
  return c;
}

async function cardMembersTable(editable){
  const members = await getMembers();
  const c = el("div","card");
  c.innerHTML = `<h3>Clanmitglieder</h3>`;
  const rows = members.map((m,i)=>[
    `<b>${m.ign}</b>`,
    m.discord,
    m.ranks.join(", "),
    editable?`<button class="btn small bad" onclick="delMember(${i})">Entfernen</button>`:""
  ]);
  c.appendChild(table(["Ingame","Discord","R√§nge","Aktion"], rows));
  return c;
}


async function cardMemberForm(){
  const c = el("div","card");
  c.innerHTML = `
    <h3>Mitglied eintragen</h3>
    <div class="row">
      <input id="mi" class="input" placeholder="Ingame-Name">
      <input id="md" class="input" placeholder="Discord-Name">
      <input id="mr" class="input" placeholder="Wichtigste R√§nge (Komma getrennt)">
      <button class="btn primary" id="ms">Speichern</button>
    </div>`;
  c.querySelector("#ms").onclick = async ()=>{
    const ign=c.querySelector("#mi").value.trim();
    const disc=c.querySelector("#md").value.trim();
    const ranks=c.querySelector("#mr").value.split(",").map(s=>s.trim()).filter(Boolean);
    if(!ign) return toast("Ingame-Name erforderlich", true);
    const arr = await getMembers();
    arr.push({ign,discord:disc,ranks});
    await setMembers(arr); toast("Mitglied gespeichert"); await routeTo("members");
  };
  return c;
}

function topRanking(supports){
  const counts = {};
  supports.forEach(s=>{ counts[s.by]=(counts[s.by]||0)+1; });
  const top = Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,3);
  return top.length ? top.map((t,i)=>`#${i+1} ${t[0]} ‚Äì ${t[1]}`).join("<br>") : "‚Äî";
}  

/* Actions */
async function delUser(id){
  if(!confirm("Konto wirklich l√∂schen?")) return;
  const users = (await getUsers()).filter(u=>u.id!==id);
  await setUsers(users);
  toast("Konto gel√∂scht");
  routeTo("accounts");
}

async function setRole(id,role){
  const users = await getUsers();
  const i = users.findIndex(u=>u.id===id);
  users[i].role = role;
  await setUsers(users);
  toast("Rolle ge√§ndert");
  routeTo("accounts");
}

async function delMember(i){
  const arr = await getMembers();
  arr.splice(i,1);
  await setMembers(arr);
  toast("Mitglied entfernt");
  routeTo("members");
}

async function delLink(i){
  const x = await getLinks();
  x.splice(i,1);
  await setLinks(x);
  toast("Link gel√∂scht");
  routeTo("links");
}

function delSupport(id){
  const x = getSupports().filter(s=>s.id!==id);
  setSupports(x);
  toast("Eintrag gel√∂scht");
  routeTo("supports");
}

async function routeTo(view){
  window.location.hash = view;
  const outlet = qs("#outlet");
  outlet.innerHTML = "";

  let c;
  switch(view){
    case "home": c = await viewHome(); break;
    case "members": c = await viewMembers(); break;
    case "team": c = await viewTeam(); break;
    case "links": c = await viewLinks(); break;
    case "support": c = await viewSupport(); break;
    case "accounts": c = await viewAccounts(); break;
    case "admin": c = await viewAdmin(); break;
    case "profile": c = await viewProfile(); break;
    case "login": c = await viewLogin(); break;
    default: c = el("div","card","Seite nicht gefunden");
  }

  if(c) outlet.appendChild(c);
}

  
/* expose handlers */
window.setRole=setRole;
window.delUser=delUser;
window.delMember=delMember;
window.delLink=delLink;
window.delSupport=delSupport;

/* boot */
renderTop();
routeTo((location.hash||"#home").slice(1));
window.addEventListener("load", async ()=>{
  renderTop();
  const initial = window.location.hash.slice(1) || "home";
  await routeTo(initial);
});
</script>
</body>
</html>
